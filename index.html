<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GTM Playground</title>
  <style>
    /*
     * Base layout styling.  A subtle background colour and modern
     * typography give the app a more contemporary feel.  The
     * content is centred with a maximum width to improve readability.
     */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background: #f7f9fb;
      color: #333;
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }

    /* Form controls adopt a consistent height, border radius and
       light border. */
    input,
    textarea {
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
    }
    input {
      width: 300px;
    }
    textarea {
      width: 100%;
      font-family: monospace;
      resize: both;
      overflow: auto;
      background: #fff;
    }

    /* General button styling with a primary colour palette and
       transitions for hover effects.  A small border radius softens
       corners. */
    button {
      font-size: 16px;
      padding: 8px 14px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: #fff;
      transition: background-color 0.15s ease;
      display: inline-block;
    }
    button:hover {
      background-color: #0056b3;
    }
    .small-button {
      font-size: 14px;
      padding: 6px 10px;
    }
    /* Each group of preset controls is laid out as a card with a
       subtle shadow and rounded corners. */
    .preset-wrapper {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      margin-bottom: 20px;
      border: 1px solid #eceff3;
      border-radius: 4px;
      padding: 15px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    }
    .preset-buttons {
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      margin-top: 0;
    }
    .preset-textarea {
      flex: 1;
      min-height: 100px;
    }
    /* Headings use a modern size/weight and extra spacing around
       sections. */
    .label {
      font-weight: 600;
      margin: 40px 0 15px;
      font-size: 28px;
    }
    .preset-header {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    /* Log output adopts a card-like style similar to presets. */
    .log {
      margin-top: 15px;
      background: #fff;
      padding: 10px;
      border: 1px solid #eceff3;
      border-radius: 4px;
      font-family: monospace;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    /*
     * Layout helpers for the top action buttons.  These classes group the three
     * preset actions (save, copy all and reset) together near the top of the
     * page and arrange them horizontally.  Each group contains the primary
     * button and its descriptive caption stacked vertically.  The flex
     * container allows the groups to sit side‚Äëby‚Äëside and wrap on narrow
     * screens.
     */
    .top-buttons {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .button-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    /*
     * Custom JS section styling inspired by Google Tag Manager.  The
     * section uses a card with a light header bar containing the title
     * and action buttons.  The textarea occupies the remainder of
     * the card without its own border, giving a cohesive look.
     */
    .custom-js-section {
      border: 1px solid #eceff3;
      border-radius: 4px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
      margin-bottom: 40px;
    }
    .custom-js-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f5f7fa;
      border-bottom: 1px solid #eceff3;
      padding: 12px 16px;
      font-weight: 600;
      font-size: 20px;
    }
    .custom-js-actions button {
      margin-left: 10px;
    }
    .custom-js-section textarea {
      border: none;
      border-radius: 0 0 4px 4px;
      padding: 12px 16px;
      min-height: 120px;
      resize: vertical;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>GTM Playground</h1>

  <label for="gtmId">Enter your GTM Container ID:</label><br>
  <input type="text" id="gtmId" placeholder="GTM-XXXXXXX" />
  <button onclick="loadGTM()">Inject GTM</button>

  
  <!-- Top action buttons: save, copy all and reset.  These were previously
       located beneath the presets section but have been moved here for
       quicker access.  Each button is accompanied by a short description. -->
  <div class="top-buttons">
    <div class="button-group">
      <button onclick="savePresets()">üíæ Save Changes to localStorage</button>
      <p style="margin-top: 0; color: gray;">Gem √¶ndringer, s√• de bevares ved reload.</p>
    </div>
    <div class="button-group">
      <button onclick="copyAllAsDataLayer()">üìã Copy ALL as datalayer.js file</button>
      <p style="margin-top: 0; color: gray;">Kopierer alle events i formatet klar til <code>datalayer.js</code>.</p>
    </div>
    <div class="button-group">
      <button onclick="resetPresets()">‚ôªÔ∏è Reset and use datalayer.js</button>
      <p style="margin-top: 0; color: gray;">Fjerner gemte events og henter igen fra <code>datalayer.js</code>.</p>
    </div>
  </div>

  <hr>

  <!-- Modernised custom JS section inspired by GTM UI -->
  <div class="custom-js-section">
    <div class="custom-js-header">
      <span>Free custom JS</span>
      <div class="custom-js-actions">
        <button onclick="runCustom()">Run JS</button>
        <button class="small-button" onclick="copyCustom()">Copy</button>
      </div>
    </div>
    <textarea id="customJson" rows="6">// Example:
dataLayer.push({
  event: "custom_event",
  my_value: 123
});</textarea>
  </div>

  <div class="log" id="logOutput">Console output will appear here‚Ä¶</div>

  <hr>

  <div class="label">Test Events (editable in <code>datalayer.js</code>)</div>
  <div id="presetsArea"></div>
  <!-- The preset action buttons have been moved to the top of the page.  The
       original buttons and descriptions were removed from this location. -->

  <script src="datalayer.js"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function loadGTM() {
    const id = document.getElementById('gtmId').value.trim();
    if (!id.match(/^GTM-[A-Z0-9]+$/i)) {
      alert('Invalid GTM ID');
      return;
    }
    localStorage.setItem('gtm_id', id);
    const script = document.createElement('script');
    script.src = 'https://www.googletagmanager.com/gtm.js?id=' + id;
    script.async = true;
    document.head.appendChild(script);
    dataLayer.push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });

    const iframe = document.createElement('iframe');
    iframe.src = `https://www.googletagmanager.com/ns.html?id=${id}`;
    iframe.height = 0;
    iframe.width = 0;
    iframe.style.display = 'none';
    iframe.style.visibility = 'hidden';
    document.body.appendChild(iframe);
  }

  function runCustom() {
    try {
      const raw = document.getElementById('customJson').value;
      new Function(raw)();
      log('‚úÖ Ran custom JS');
    } catch (e) {
      log('‚ùå Error: ' + e.message);
    }
  }

  function copyCustom() {
    const textarea = document.getElementById('customJson');
    textarea.select();
    document.execCommand('copy');
    log('üìã Copied custom JS');
  }

  function log(msg) {
    document.getElementById('logOutput').textContent = msg;
    console.log(msg);
  }

  const defaultPresets = window.gtmPresets || [];

  function loadPresets() {
    const saved = localStorage.getItem('presets_full_js');
    const presets = saved ? JSON.parse(saved) : defaultPresets;

    const container = document.getElementById('presetsArea');
    container.innerHTML = '';

    presets.forEach((preset, i) => {
      container.appendChild(renderPreset(preset, i));
    });
  }

  function renderPreset(preset, index) {
  const wrapper = document.createElement('div');
  wrapper.className = 'preset-wrapper';

  const buttons = document.createElement('div');
  buttons.className = 'preset-buttons';

  const runBtn = document.createElement('button');
  runBtn.textContent = 'Push';

  const copyBtn = document.createElement('button');
  copyBtn.textContent = 'Copy as dataLayer.push';
  copyBtn.className = 'small-button';

  const copyDLBtn = document.createElement('button');
  copyDLBtn.textContent = 'Copy as datalayer.js block';
  copyDLBtn.className = 'small-button';

  const label = document.createElement('div');
  label.className = 'preset-header';
  label.textContent = 'Event: ' + (preset.name || `custom_${index + 1}`);

  const textarea = document.createElement('textarea');
  textarea.className = 'preset-textarea';
  textarea.dataset.index = index;
  textarea.dataset.name = preset.name || `custom_${index + 1}`;
  textarea.value = preset.code;
  textarea.rows = 10;

  runBtn.onclick = () => {
    try {
      new Function(textarea.value)();
      log(`‚úÖ Executed: ${label.textContent}`);
    } catch (e) {
      log('‚ùå Error parsing JS: ' + e.message);
    }
  };

  copyBtn.onclick = () => {
    textarea.select();
    document.execCommand('copy');
    log('üìã Copied as dataLayer.push');
  };

  copyDLBtn.onclick = () => {
    const name = textarea.dataset.name || `custom_${index + 1}`;
    const fullBlock = 
`// ===== START ${name} =====  
{
  name: "${name}",
  code: \`${textarea.value}\`
},
// ===== END ${name} =====`;
    navigator.clipboard.writeText(fullBlock).then(() => {
      log('üìã Copied as datalayer.js block');
    });
  };

  buttons.appendChild(runBtn);
  buttons.appendChild(copyBtn);
  buttons.appendChild(copyDLBtn);

  const container = document.createElement('div');
  container.style.flex = '1';
  container.appendChild(label);
  container.appendChild(textarea);

  wrapper.appendChild(buttons);
  wrapper.appendChild(container);
  return wrapper;
}


  function savePresets() {
    const all = document.querySelectorAll('.preset-textarea');
    const updated = Array.from(all).map((el) => {
      const wrapper = el.closest('.preset-wrapper');
      const label = wrapper.querySelector('.preset-header').textContent;
      const name = label.replace('Event: ', '').trim();

      return {
        name: name,
        code: el.value
      };
    });
    localStorage.setItem('presets_full_js', JSON.stringify(updated));
    log('üíæ Presets saved to localStorage');
    loadPresets();
  }

  function resetPresets() {
  localStorage.removeItem('presets_full_js');
  log('‚ôªÔ∏è LocalStorage cleared. Reloading datalayer.js presets‚Ä¶');

  // Hent igen fra original datalayer.js
  const fallbackPresets = window.gtmPresets || [];
  const container = document.getElementById('presetsArea');
  container.innerHTML = '';
  fallbackPresets.forEach((preset, i) => {
    container.appendChild(renderPreset(preset, i));
  });
}

  function copyAllAsDataLayer() {
  const all = document.querySelectorAll('.preset-textarea');

  const eventBlocks = Array.from(all).map((el, i) => {
    const name = el.dataset.name || `custom_${i + 1}`;
    const code = el.value;

    return `// ===== START ${name} =====  
{
  name: "${name}",
  code: \`${code}\`
},
// ===== END ${name} =====`;
  });

  const finalCode = `const presetEvents = [\n${eventBlocks.join('\n\n')}\n];\n\nwindow.gtmPresets = presetEvents;`;

  navigator.clipboard.writeText(finalCode).then(() => {
    log('üìã All events copied as datalayer.js file');
  });
}


  window.addEventListener('load', () => {
    const lastId = localStorage.getItem('gtm_id');
    if (lastId) document.getElementById('gtmId').value = lastId;
    loadPresets();
  });
</script>
</body>
</html>



